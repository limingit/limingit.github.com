
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>微博应用框架开发文档 - Begin iOS</title>
  <meta name="author" content="Bencalie">

  
  <meta name="description" content="微博应用框架开发文档 Jan 17th, 2014 此文档只针对新接入的第三方应用，原有的站内应用、企业应用（专业版应用）、Page应用，需要第三方进行代码升级并在平台网站升级后才能使用。 为了规范第三方应用接入，提供一致性的开发接入模式，2014年微博对原有的三种应用框架体系进行整合， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://limingit.github.io/javascript/weibo-app-frame.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Begin iOS" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<base target="_self"/>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Begin iOS</a></h1>
  
    <h2>A guide for iOS developer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:limingit.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/objective-c/">Objective-C</a></li>
  <li><a href="/ios/">iOS</a></li>
  <li><a href="/cocos2d-x/">Cocos2d-x</a></li>
  <li><a href="/javascript/">Javascript</a></li>
  <li><a href="/android/">Android</a></li>
  <li><a href="/resources/">Resources</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">微博应用框架开发文档</h1>
    <p class="meta">








  


<time datetime="2014-01-17T04:30:00+00:00" pubdate data-updated="true">Jan 17<span>th</span>, 2014</time></p>
  </header>
  
  <p>此文档只针对新接入的第三方应用，原有的站内应用、企业应用（专业版应用）、Page应用，需要第三方进行代码升级并在平台网站升级后才能使用。</p>

<p>为了规范第三方应用接入，提供一致性的开发接入模式，2014年微博对原有的三种应用框架体系进行整合，形成一套新的框架体系。</p>

<h2>文档目录</h2>

<ul>
<li><a href="#feature">新版应用框架特性</a></li>
<li><a href="#create">创建应用</a></li>
<li><a href="#parameter">应用框架 POST 参数</a></li>
<li><a href="#client">Web版应用客户端 JS 包使用说明</a></li>
<li><a href="#faq">FAQ</a></li>
<li><a href="#contact">联系我们</a></li>
</ul>


<h2>新版应用框架特性<a id="feature"></a></h2>

<ul>
<li><strong>无需授权</strong>。如果用户在登录状态访问应用，新的框架将默认授权。</li>
<li><strong>统一参数</strong>。无论是哪种类型的应用，无论是 Web 版还是客户端嵌入的 H5 版本，客户端收到的参数都是相同的。</li>
<li><strong>统一接入方式</strong>。开发者无论是接入站内应用、企业应用、Page应用，都是相同的接入方式，无需再</li>
</ul>


<h2>创建应用<a id="create"></a></h2>

<p>略，参考开放平台网站文档</p>

<h2>应用框架 POST 参数<a id="parameter"></a></h2>

<p>应用框架会通过 POST 形式，发送给第三方页面一个加密后的参数， signed_request</p>

<h3>自动授权失败参数</h3>

<table>
<thead>
<tr>
<th>参数名       </th>
<th> 必选            </th>
<th> 类型            </th>
<th> 说明    </th>
</tr>
</thead>
<tbody>
<tr>
<td>user        </td>
<td> true          </td>
<td> Array         </td>
<td> 当前用户对象        </td>
</tr>
<tr>
<td>algorithm   </td>
<td> true          </td>
<td> String        </td>
<td> 签名算法，暂时用 HMAC-SHA256  </td>
</tr>
<tr>
<td>issued_at   </td>
<td> true          </td>
<td> Int           </td>
<td> 服务端生成时间，unix timestamp 格式  </td>
</tr>
<tr>
<td>referer     </td>
<td> true          </td>
<td> String        </td>
<td> 页面的 document.referrer </td>
</tr>
<tr>
<td>ouid        </td>
<td> false         </td>
<td> uint64        </td>
<td> 当前应用的安装者 uid，站内应用无此参数</td>
</tr>
</tbody>
</table>


<h3>自动授权成功参数</h3>

<table>
<thead>
<tr>
<th>参数名       </th>
<th> 必选            </th>
<th> 类型            </th>
<th> 说明    </th>
</tr>
</thead>
<tbody>
<tr>
<td>user        </td>
<td> true          </td>
<td> Array         </td>
<td> 当前用户对象        </td>
</tr>
<tr>
<td>algorithm   </td>
<td> true          </td>
<td> String        </td>
<td> 签名算法，暂时用 HMAC-SHA256  </td>
</tr>
<tr>
<td>issued_at   </td>
<td> true          </td>
<td> Int           </td>
<td> 服务端生成时间，unix timestamp 格式  </td>
</tr>
<tr>
<td>expires     </td>
<td> true          </td>
<td> Int           </td>
<td> access_token 过期时间，unix timestamp 格式 </td>
</tr>
<tr>
<td>oauth_token </td>
<td> true          </td>
<td> String        </td>
<td> access_token </td>
</tr>
<tr>
<td>user_id     </td>
<td> true          </td>
<td> unit64        </td>
<td> 当前用户微博 user id </td>
</tr>
<tr>
<td>referer     </td>
<td> true          </td>
<td> String        </td>
<td> 页面的 document.referrer </td>
</tr>
<tr>
<td>scope       </td>
<td> true          </td>
<td> String        </td>
<td> 应用的 scope 参数 </td>
</tr>
<tr>
<td>ext_data    </td>
<td> false         </td>
<td> String        </td>
<td> 扩展字段，暂时用不上 </td>
</tr>
<tr>
<td>ouid        </td>
<td> false         </td>
<td> uint64        </td>
<td> 当前应用的安装者 uid，站内应用无此参数</td>
</tr>
</tbody>
</table>


<figure class='code'><figcaption><span>从POST过来的signed_request中提取oauth2信息 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;signed_request&quot;</span><span class="p">])){</span>
</span><span class='line'>  <span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SaeTOAuth</span><span class="p">(</span> <span class="nx">WB_AKEY</span> <span class="p">,</span> <span class="nx">WB_SKEY</span>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$data</span><span class="o">=</span><span class="nv">$o</span><span class="o">-&gt;</span><span class="na">parseSignedRequest</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;signed_request&quot;</span><span class="p">]);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$data</span><span class="o">==</span><span class="s1">&#39;-2&#39;</span><span class="p">){</span>
</span><span class='line'>       <span class="k">die</span><span class="p">(</span><span class="s1">&#39;sign is error!&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;oauth2&#39;</span><span class="p">]</span><span class="o">=</span><span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Web版应用客户端 JS 包使用说明<a id="client"></a></h2>

<h3>引入JS文件</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://tjs.sjs.sinajs.cn/open/thirdpart/js/frame/appclient.js&quot;</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果你在 open.weibo.com 设置了应用的高度为自适应，且引入了这个 JS 到需要自适应高度的页面，你的应用就能自动适应高度了。</p>

<p><em>友情提示</em>：为了对页面性能产生最小的影响，建议此文件放在 &lt;/body&gt; 之前</p>

<h3>API方法</h3>

<p>1、<strong>触发行为</strong></p>

<p>App.trigger(&lsquo;&lt;cmd&gt;&rsquo;, [&lsquo;&lt;param&gt;&rsquo;, [&lsquo;&lt;function&gt;&rsquo;]]);</p>

<ul>
<li>&lt;cmd&gt; 必选参数，指定行为的名称</li>
<li>&lt;param&gt; 可选参数，指定调用行为的参数</li>
<li>&lt;function&gt; 可选参数，指定行为的异步回调函数</li>
</ul>


<p>&lt;cmd&gt; 列表如下：</p>

<p><em>setPageHeight</em> 设置iframe自身的高度</p>

<figure class='code'><figcaption><span>设置页面高度为 500px </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;setPageHeight &#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>scrollTo</em> 改变父页面滚动条位置</p>

<figure class='code'><figcaption><span>设置父页面滚动到顶部位置200px的地方 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;scrollTo&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>设置父页面滚动到iframe的顶部位置 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;scrollTo&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>parentInfo</em> 获取父页面信息</p>

<figure class='code'><figcaption><span>获取父页面信息 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;parentInfo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parentWin</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">parentWin</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>parentWin.iframe.width 获得iframe宽度</li>
<li>parent.iframe.height 获得iframe高度</li>
<li>parent.iframe.left 获得iframe距离父页面左端的距离</li>
<li>parent.iframe.top 获得iframe距离父页面顶端的距离</li>
<li>parent.page.height 父页面高度</li>
<li>parent.page.width 父页面宽度</li>
<li>parent.page.height 父页面高度</li>
<li>parent.page.scrollTop 父页面的滚动条scrollTop</li>
<li>parent.page.scrollLeft 父页面的滚动条scrollLeft</li>
<li>parent.page.url 父页面url</li>
</ul>


<p>2、<strong>事件监听</strong> (on/off)</p>

<p>App.on(&lsquo;&lt;event&gt;&rsquo;, &lsquo;&lt;function&gt;&rsquo;);</p>

<p>App.off(&lsquo;&lt;event&gt;&rsquo;, &lsquo;&lt;function&gt;&rsquo;);</p>

<ul>
<li>&lt;event&gt;为必选参数，指定要监听的事件称</li>
<li>&lt;function&gt;为可选参数，指定事件的异步回调函数</li>
</ul>


<p>&lt;event&gt; 列表如下：</p>

<p><em>scroll</em> 外层滚动页面的事件</p>

<figure class='code'><figcaption><span>绑定 scroll 事件 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scrollPos</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">scrollPos</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>scrollPos.top 纵向滚动条距顶部距离</li>
<li>scrollPos.left 横向滚动条距左边框距离</li>
</ul>


<figure class='code'><figcaption><span>解绑 scroll 事件 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>resize</em> 外层改变页面大小的事件</p>

<figure class='code'><figcaption><span>绑定 resize 事件 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parentWin</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">parentWin</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>parentWin.page.width 父页面宽度</li>
<li>parentWin.page.height 父页面高度</li>
<li>parentWin.win.width 父页面窗口宽度</li>
<li>parentWin.win.height 父页面窗口高度</li>
</ul>


<figure class='code'><figcaption><span>解绑 resize 事件 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>FAQ<a id="faq"></a></h3>

<p>我的应用不升级，还能继续使用吗？</p>

<p>我如何区分是Web版还是H5版</p>

<p>特定的 URL 怎么指定？</p>

<p>我的应用为何没有自适应高度？</p>

<p>我的页面大于 5000px，被框架挡住了，怎么办？</p>

<h3>联系我们<a id="contact"></a></h3>

  
</article>

</div>

<aside class="sidebar">
  
    <section>
	<h1>&#x5173;&#x4e8e;&#x6211;</h1>
	<p>Front-End Engineer</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/14/using-the-application-cache/">使用 HTML5 应用缓存加速移动页面</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/14/charles-proxy-for-mac/">Mac OS 下抓包工具 Charles 使用</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/10/preface/">序</a>
      </li>
    
  </ul>
</section>
<section>
	<h1>Tags</h1>
	<ul class="tag_cloud">
		<a style="font-size: 90%" href="/tags/applicationcache/">ApplicationCache</a>
<a style="font-size: 90%" href="/tags/charles/">Charles</a>
<a style="font-size: 90%" href="/tags/html5/">HTML5</a>
<a style="font-size: 90%" href="/tags/web-debugging-proxy/">Web Debugging Proxy</a>
<a style="font-size: 210%" href="/tags/jing-yan/">经验</a>

	</ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/limingit">@limingit</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'limingit',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Bencalie -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>


  <script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new?Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-47018713-1', 'beginios.com');
	ga('send', 'pageview');
  </script>


</footer>
  











</body>
</html>
